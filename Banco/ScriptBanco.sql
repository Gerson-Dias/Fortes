/******************************************************************************/
/****        Generated by IBExpert 2015.12.21.1 28/02/2021 17:21:46        ****/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES ISO8859_1;

CREATE DATABASE '127.0.0.1:D:\Curso\Teste_Fortes\Banco\BANCOPOSTO.FDB'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 16384
DEFAULT CHARACTER SET ISO8859_1 COLLATION ISO8859_1;



/******************************************************************************/
/****                              Generators                              ****/
/******************************************************************************/

CREATE GENERATOR GEN_TB_ABASTECIMENTO_ID;
SET GENERATOR GEN_TB_ABASTECIMENTO_ID TO 29;

CREATE GENERATOR GEN_TB_BOMBA_COMBUSTIVEL_ID;
SET GENERATOR GEN_TB_BOMBA_COMBUSTIVEL_ID TO 0;

CREATE GENERATOR GEN_TB_MOVIMENTO_ID;
SET GENERATOR GEN_TB_MOVIMENTO_ID TO 18;

CREATE GENERATOR GEN_TB_POSTO_ID;
SET GENERATOR GEN_TB_POSTO_ID TO 0;

CREATE GENERATOR GEN_TB_TANQUE_ID;
SET GENERATOR GEN_TB_TANQUE_ID TO 0;



/******************************************************************************/
/****                                Tables                                ****/
/******************************************************************************/



CREATE TABLE TB_ABASTECIMENTO (
    ID             INTEGER NOT NULL,
    MOVIMENTO_ID   INTEGER,
    QTD_LITRO      NUMERIC(15,2),
    VALOR_TOTAL    NUMERIC(15,2),
    VALOR_IMPOSTO  NUMERIC(15,2)
);

CREATE TABLE TB_BOMBA_COMBUSTIVEL (
    ID          INTEGER NOT NULL,
    TANQUE_ID   INTEGER NOT NULL,
    NOME_BOMBA  VARCHAR(20)
);

CREATE TABLE TB_MOVIMENTO (
    ID            INTEGER NOT NULL,
    BOMBA_ID      INTEGER NOT NULL,
    DATA          DATE,
    STATUS        VARCHAR(10),
    IMPOSTO_PERC  NUMERIC(5,2),
    VALOR_LITRO   NUMERIC(15,2)
);

CREATE TABLE TB_POSTO (
    ID              INTEGER NOT NULL,
    NOME_POSTO      VARCHAR(150),
    ENDERECO_POSTO  VARCHAR(200)
);

CREATE TABLE TB_TANQUE (
    ID                INTEGER NOT NULL,
    POSTO_ID          INTEGER NOT NULL,
    TIPO_COMBUSTIVEL  VARCHAR(10)
);

INSERT INTO TB_BOMBA_COMBUSTIVEL (ID, TANQUE_ID, NOME_BOMBA) VALUES (1, 1, 'Bomba 01');
INSERT INTO TB_BOMBA_COMBUSTIVEL (ID, TANQUE_ID, NOME_BOMBA) VALUES (2, 2, 'Bomba 02');
INSERT INTO TB_BOMBA_COMBUSTIVEL (ID, TANQUE_ID, NOME_BOMBA) VALUES (3, 1, 'Bomba 03');
INSERT INTO TB_BOMBA_COMBUSTIVEL (ID, TANQUE_ID, NOME_BOMBA) VALUES (4, 2, 'Bomba 04');

COMMIT WORK;

INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (1, 1, '2021-02-01', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (2, 1, '2021-02-02', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (3, 2, '2021-02-01', 'Aberto', 13, 3.7);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (4, 2, '2021-02-02', 'Aberto', 13, 3.7);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (5, 3, '2021-02-01', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (6, 3, '2021-02-02', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (7, 4, '2021-02-01', 'Fechado', 13, 3.7);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (9, 4, '2021-02-02', 'Fechado', 13, 3.7);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (10, 1, '2021-02-27', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (11, 2, '2021-02-27', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (12, 4, '2021-02-27', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (13, 3, '2021-02-27', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (14, 1, '2021-02-28', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (15, 4, '2021-02-28', 'Aberto', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (16, 1, '2021-02-03', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (17, 3, '2021-02-03', 'Fechado', 13, 5.39);
INSERT INTO TB_MOVIMENTO (ID, BOMBA_ID, DATA, STATUS, IMPOSTO_PERC, VALOR_LITRO) VALUES (18, 1, '2021-02-04', 'Fechado', 13, 5.39);

COMMIT WORK;

INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (1, 1, 18.32, 98.74, 12.83);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (2, 12, 3.71, 20, 2.6);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (3, 13, 1.86, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (4, 13, 5.57, 30, 3.9);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (5, 13, 3, 16.17, 2.1);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (6, 12, 18.55, 100, 13);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (7, 11, 25, 134.75, 17.51);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (8, 12, 6.12, 33, 4.29);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (9, 13, 0.19, 1, 0.13);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (10, 13, 0.74, 4, 0.52);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (11, 10, 20.59, 111, 14.43);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (12, 13, 41.19, 222, 28.86);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (13, 10, 18.55, 100, 13);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (14, 10, 2.04, 11, 1.43);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (15, 13, 8.16, 44, 5.72);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (16, 10, 50, 269.5, 35.03);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (17, 14, 1.86, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (18, 15, 18.55, 100, 13);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (19, 14, 4.64, 25, 3.25);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (20, 14, 1.86, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (21, 16, 4.64, 25, 3.25);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (22, 16, 30, 161.7, 21.02);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (23, 2, 1.86, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (24, 6, 4.64, 25, 3.25);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (25, 4, 2.7, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (26, 6, 4.64, 25, 3.25);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (27, 17, 1.86, 10, 1.3);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (28, 18, 18.74, 101, 13.13);
INSERT INTO TB_ABASTECIMENTO (ID, MOVIMENTO_ID, QTD_LITRO, VALOR_TOTAL, VALOR_IMPOSTO) VALUES (29, 10, 9.28, 50, 6.5);

COMMIT WORK;

INSERT INTO TB_POSTO (ID, NOME_POSTO, ENDERECO_POSTO) VALUES (1, 'POSTO ABC', 'RUA DO ALFABETO');

COMMIT WORK;

INSERT INTO TB_TANQUE (ID, POSTO_ID, TIPO_COMBUSTIVEL) VALUES (1, 1, 'Gasolina');
INSERT INTO TB_TANQUE (ID, POSTO_ID, TIPO_COMBUSTIVEL) VALUES (2, 1, 'Diesel');

COMMIT WORK;



/******************************************************************************/
/****                             Primary keys                             ****/
/******************************************************************************/

ALTER TABLE TB_ABASTECIMENTO ADD CONSTRAINT PK_TB_ABASTECIMENTO PRIMARY KEY (ID);
ALTER TABLE TB_BOMBA_COMBUSTIVEL ADD CONSTRAINT PK_TB_BOMBA_COMBUSTIVEL PRIMARY KEY (ID);
ALTER TABLE TB_MOVIMENTO ADD CONSTRAINT PK_TB_MOVIMENTO PRIMARY KEY (ID);
ALTER TABLE TB_POSTO ADD CONSTRAINT PK_TB_POSTO PRIMARY KEY (ID);
ALTER TABLE TB_TANQUE ADD CONSTRAINT PK_TB_TANQUE PRIMARY KEY (ID);


/******************************************************************************/
/****                             Foreign keys                             ****/
/******************************************************************************/

ALTER TABLE TB_ABASTECIMENTO ADD CONSTRAINT FK_TB_ABASTECIMENTO_MOVIMENTO FOREIGN KEY (MOVIMENTO_ID) REFERENCES TB_MOVIMENTO (ID);
ALTER TABLE TB_BOMBA_COMBUSTIVEL ADD CONSTRAINT FK_TB_BOMBA_TB_TANQUE FOREIGN KEY (TANQUE_ID) REFERENCES TB_TANQUE (ID);
ALTER TABLE TB_MOVIMENTO ADD CONSTRAINT FK_TB_MOVIMENTO_TB_BOMBA FOREIGN KEY (BOMBA_ID) REFERENCES TB_BOMBA_COMBUSTIVEL (ID);
ALTER TABLE TB_TANQUE ADD CONSTRAINT FK_TB_TANQUE_TB_POSTO FOREIGN KEY (POSTO_ID) REFERENCES TB_POSTO (ID);


/******************************************************************************/
/****                               Indices                                ****/
/******************************************************************************/

CREATE INDEX TB_MOVIMENTO_IDX_DATA ON TB_MOVIMENTO (DATA);


/******************************************************************************/
/****                               Triggers                               ****/
/******************************************************************************/



SET TERM ^ ;



/******************************************************************************/
/****                         Triggers for tables                          ****/
/******************************************************************************/



/* Trigger: TRG_ABASTECIMENTO_ID */
CREATE TRIGGER TRG_ABASTECIMENTO_ID FOR TB_ABASTECIMENTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.id = gen_id(gen_tb_abastecimento_id,1);
end
^

/* Trigger: TRG_BOMBA_COMBUSTIVEL_ID */
CREATE TRIGGER TRG_BOMBA_COMBUSTIVEL_ID FOR TB_BOMBA_COMBUSTIVEL
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.id = gen_id(gen_tb_bomba_combustivel_id,1);
end
^

/* Trigger: TRG_MOVIMENTO_ID */
CREATE TRIGGER TRG_MOVIMENTO_ID FOR TB_MOVIMENTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.id = gen_id(gen_tb_movimento_id,1);
end
^

/* Trigger: TRG_POSTO_ID */
CREATE TRIGGER TRG_POSTO_ID FOR TB_POSTO
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.id = gen_id(gen_tb_posto_id,1);
end
^

/* Trigger: TRG_TANQUE_ID */
CREATE TRIGGER TRG_TANQUE_ID FOR TB_TANQUE
ACTIVE BEFORE INSERT POSITION 0
AS
begin
  new.id = gen_id(gen_tb_tanque_id,1);
end
^
SET TERM ; ^



/******************************************************************************/
/****                             Descriptions                             ****/
/******************************************************************************/

DESCRIBE TABLE TB_ABASTECIMENTO
'Detalhe do Movimento Diário de Cada Bomba - Abastecimentos';

DESCRIBE TABLE TB_BOMBA_COMBUSTIVEL
'Bomba de combustivel';

DESCRIBE TABLE TB_MOVIMENTO
'Cabecalho do Movimento Diário de Cada Bomba';

DESCRIBE TABLE TB_POSTO
'Identificação do Posto de Combustível';

DESCRIBE TABLE TB_TANQUE
'Tanque de Combustivel';

